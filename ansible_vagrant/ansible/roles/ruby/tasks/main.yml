- name: initial setting confirmation
  shell: which ruby
  register: init_flag
  failed_when: init_flag.rc not in [0, 1]

- name: git clone rbenv
  git:
    repo: https://github.com/rbenv/rbenv.git
    dest: /home/grizzly/.rbenv
  become_user: grizzly
  when: init_flag.rc == 1

- name: compile rbenv
  shell: cd ~/.rbenv && src/configure && make -C src
  become_user: grizzly
  when: init_flag.rc == 1

- name: setting bash_profile
  blockinfile:
    dest: /home/grizzly/.bash_profile
    owner: grizzly
    block: |
      export PATH="$HOME/.rbenv/bin:$PATH"
      eval "$(rbenv init -)"
  when: init_flag.rc == 1

- name: make plugin directory
  file:
    path: /home/grizzly/.rbenv/plugins
    owner: grizzly
    state: directory
  when: init_flag.rc == 1

- name: install plugin
  git:
    repo: https://github.com/rbenv/ruby-build.git
    dest: /home/grizzly/.rbenv/plugins/ruby-build
  become_user: grizzly
  when: init_flag.rc == 1

- name: install library
  yum:
    name:
      - openssl-devel
      - readline-devel
      - zlib-devel
  when: init_flag.rc == 1

- name: rbenv install
  shell: bash -lc "rbenv install 2.5.1"
  become_user: grizzly
  when: init_flag.rc == 1

- name: setting ruby version
  shell: bash -lc "rbenv shell 2.5.1"
  become_user: grizzly
  when: init_flag.rc == 1

- name: rbenv global
  shell: bash -lc "rbenv global 2.5.1"
  become_user: grizzly
  when: init_flag.rc == 1

- name: install bundler
  gem:
    name: bundler
    user_install: False
    executable: /home/grizzly/.rbenv/shims/gem
  become_user: grizzly
  when: init_flag.rc == 1
